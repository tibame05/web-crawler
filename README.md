# ğŸ“Š å°è‚¡ ETF åˆ†æèˆ‡å›æ¸¬å¹³å°

æœ¬å°ˆæ¡ˆæ˜¯ä¸€å¥—**è‡ªå‹•åŒ–è³‡æ–™æ“·å–ã€æŠ€è¡“åˆ†æèˆ‡å›æ¸¬æ¨¡æ“¬å¹³å°**ï¼Œé‡å°Â [Yahoo å°è‚¡ ETF](https://tw.stock.yahoo.com/tw-etf)Â ä¸Šå¸‚æ¨™çš„ï¼Œæä¾›æ¯æ—¥æ›´æ–°çš„æ­·å²è³‡æ–™èˆ‡ç­–ç•¥è©•ä¼°ã€‚ç›®çš„æ˜¯å”åŠ©æŠ•è³‡æ–°æ‰‹é€éå¯¦è­‰è³‡æ–™ï¼Œäº†è§£ä¸åŒ ETF ç­–ç•¥çš„é•·æœŸæ•ˆç›Šèˆ‡é¢¨éšªã€‚

---

## ğŸ¯ å°ˆæ¡ˆç›®æ¨™

- ğŸ“ˆ å›æ¸¬ã€Œå°è‚¡ vs ç¾è‚¡ã€ETF é•·æœŸæŠ•è³‡è¡¨ç¾
- ğŸ“‰ æ¯”è¼ƒã€Œå®šæœŸå®šé¡ vs ä¸€æ¬¡æŠ•å…¥ã€æŠ•è³‡ç­–ç•¥
- ğŸ” å»ºç«‹æ¯æ—¥è‡ªå‹•æ›´æ–°è³‡æ–™çš„ç³»çµ±
- ğŸ” æä¾›æŠ€è¡“æŒ‡æ¨™èˆ‡ç¸¾æ•ˆ API æŸ¥è©¢æ¥å£

---

## ğŸ§± ç³»çµ±åŠŸèƒ½æ¨¡çµ„

### 1ï¸âƒ£ ETF è³‡æ–™è’é›†çˆ¬èŸ²

- å¾Â [Yahoo å°è‚¡ ETF æ¸…å–®](https://tw.stock.yahoo.com/tw-etf)Â è‡ªå‹•æ“·å–æ‰€æœ‰ä¸Šå¸‚ ETF ç·¨è™Ÿ
- ä½¿ç”¨Â `yfinance`Â æ“·å–æ¯æª” ETF çš„ï¼š
    - ğŸ“ˆÂ **æ­·å²åƒ¹æ ¼è³‡æ–™**ï¼šåŒ…å«æ¯æ—¥çš„é–‹ç›¤ï¼ˆOpenï¼‰ã€æ”¶ç›¤ï¼ˆCloseï¼‰ã€æœ€é«˜åƒ¹ï¼ˆHighï¼‰ã€æœ€ä½åƒ¹ï¼ˆLowï¼‰ã€æˆäº¤é‡ï¼ˆVolumeï¼‰èˆ‡èª¿æ•´å¾Œæ”¶ç›¤åƒ¹ï¼ˆAdj Closeï¼Œè€ƒæ…®è‚¡åˆ©èˆ‡é™¤æ¬Šæ¯å½±éŸ¿ï¼‰
    - ğŸ’°Â **é…æ¯è³‡æ–™**ï¼šé™¤æ¯æ—¥ã€æ¯å–®ä½é…æ¯é‡‘é¡

### 2ï¸âƒ£ æŠ€è¡“æŒ‡æ¨™è¨ˆç®—æ¨¡çµ„ï¼ˆ`pandas_ta`ï¼‰

ä½¿ç”¨Â `pandas_ta`Â å¥—ä»¶è¨ˆç®—å¸¸è¦‹æŠ€è¡“åˆ†ææŒ‡æ¨™ï¼ŒåŒ…æ‹¬ï¼š

- **RSIï¼ˆç›¸å°å¼·å¼±æŒ‡æ¨™ï¼‰**
    - ä½¿ç”¨ 14 æ—¥ RSI è¡¡é‡æ¼²è·Œå‹•èƒ½
    - å¸¸è¦‹è§£è®€ï¼š
        - RSI > 70ï¼šéç†±ï¼ˆå¯èƒ½è³£å‡ºï¼‰
        - RSI < 30ï¼šè¶…è³£ï¼ˆå¯èƒ½è²·å…¥ï¼‰
- **MAï¼ˆç§»å‹•å¹³å‡ç·šï¼‰**
    - è¨ˆç®— 5 æ—¥ï¼ˆMA5ï¼‰èˆ‡ 20 æ—¥ï¼ˆMA20ï¼‰å‡ç·š
    - ç”¨æ–¼è§€å¯Ÿè¶¨å‹¢èˆ‡è½‰æŠ˜é»ï¼ˆå¦‚é»ƒé‡‘äº¤å‰ã€æ­»äº¡äº¤å‰ï¼‰
- **MACDï¼ˆç§»å‹•å¹³å‡æ”¶æ–‚èƒŒé›¢æŒ‡æ¨™ï¼‰**
    - é è¨­åƒæ•¸ï¼š12ï¼ˆå¿«ç·š EMAï¼‰ã€26ï¼ˆæ…¢ç·š EMAï¼‰ã€9ï¼ˆè¨Šè™Ÿç·šï¼‰
    - è¨ˆç®—ä¸‰é …ï¼š
        - `MACD_line`ï¼šå¿«ç·š
        - `MACD_signal`ï¼šè¨Šè™Ÿç·šï¼ˆæ…¢ç·šï¼‰
        - `MACD_hist`ï¼šæŸ±ç‹€åœ–ï¼ˆå¿«ç·š âˆ’ æ…¢ç·šï¼‰
- **KD éš¨æ©Ÿéœ‡ç›ªæŒ‡æ¨™**
    - æ ¹æ“šæœ€é«˜åƒ¹ã€æœ€ä½åƒ¹èˆ‡æ”¶ç›¤åƒ¹è¨ˆç®—ï¼š
        - `%K`ï¼šå¿«é€ŸæŒ‡æ¨™
        - `%D`ï¼š%K çš„ç§»å‹•å¹³å‡
    - è§£è®€æ–¹å¼ï¼š
        - KD > 80ï¼šéç†±ï¼ˆå¯èƒ½è³£å‡ºï¼‰
        - KD < 20ï¼šè¶…è³£ï¼ˆå¯èƒ½è²·å…¥ï¼‰

### 3ï¸âƒ£ å›æ¸¬ç¸¾æ•ˆè©•ä¼°æ¨¡çµ„

æ ¹æ“š ETF çš„æ­·å²è‚¡åƒ¹ï¼Œè¨ˆç®—ä»¥ä¸‹å››é …æŠ•è³‡ç¸¾æ•ˆæŒ‡æ¨™ï¼š

- ğŸ“ŠÂ **ç¸½å ±é…¬ç‡ï¼ˆTotal Returnï¼‰**
    - å…¬å¼ï¼š`(æœ€çµ‚è³‡ç”¢ Ã· åˆå§‹è³‡ç”¢) âˆ’ 1`
    - è¡¡é‡æ•´æ®µæŠ•è³‡æœŸé–“çš„ç¸½é«”æ¼²è·Œå¹…
- ğŸ“ˆÂ **å¹´åŒ–å ±é…¬ç‡ï¼ˆCAGRï¼‰**
    - æ ¹æ“šèµ·è¨–æ—¥æœŸæ›ç®—ç‚ºå¹´ï¼Œåæ˜ è³‡ç”¢æ¯å¹´ç©©å®šå¢é•·çš„é€Ÿåº¦
- ğŸ“‰Â **æœ€å¤§å›æ’¤ï¼ˆMax Drawdownï¼‰**
    - è¨ˆç®—æ­·å²æœ€é«˜é»èˆ‡æœ€ä½é»é–“çš„æœ€å¤§è·Œå¹…
    - è©•ä¼°è³‡ç”¢å¯èƒ½é¢è‡¨çš„æœ€å¤§é¢¨éšª
- ğŸ“Â **å¤æ™®æ¯”ç‡ï¼ˆSharpe Ratioï¼‰**
    - è¡¡é‡é¢¨éšªèª¿æ•´å¾Œçš„å ±é…¬ç‡
    - å…¬å¼ï¼š`å¹´å ±é…¬ç‡ Ã· å¹´åŒ–æ³¢å‹•ç‡`ï¼ˆå‡è¨­ç„¡é¢¨éšªåˆ©ç‡ç‚º 0ï¼‰

### 4ï¸âƒ£ ç­–ç•¥æ¨¡æ“¬èˆ‡æ¯”è¼ƒ

- å®šæœŸå®šé¡ vs ä¸€æ¬¡æŠ•å…¥ vs å¹´æŠ•è³‡
- é…æ¯å†æŠ•è³‡ vs ä¿ç•™ç¾é‡‘
- æŠ•è³‡é€±æœŸèˆ‡é‡‘é¡å¯åƒæ•¸åŒ–æŸ¥è©¢

---

## ğŸ— æŠ€è¡“æ¶æ§‹åœ–

```
ETF ç·¨è™Ÿ â†’ yfinance æ“·å–è³‡æ–™ â†’ æŠ€è¡“æŒ‡æ¨™è¨ˆç®— â†’ ç­–ç•¥æ¨¡æ“¬èˆ‡å›æ¸¬
            â†“                         
        å­˜å…¥ MySQL               

```

---

## âš™ï¸ é–‹ç™¼æŠ€è¡“æ‘˜è¦

| æ¨¡çµ„ | æŠ€è¡“/å·¥å…· |
| --- | --- |
| çˆ¬èŸ² | `yfinance`,Â `requests`,Â `pandas` |
| åˆ†æå¼•æ“ | `pandas_ta`, `pandas`,Â `numpy` |
| API æœå‹™ | `FastAPI`,Â `MySQL`,Â `Cloud Run (GCP)` |
| æ’ç¨‹ç³»çµ± | `Airflow`ï¼ˆæ¯æ—¥æ›´æ–°ï¼‰ |
| éåŒæ­¥ä»»å‹™ | `Celery`,Â `RabbitMQ`,Â `Docker Compose` |
| éƒ¨ç½²æ–¹å¼ | `Docker`,Â `Docker Hub`,Â `Pipenv`,Â `Pyenv` |

---

## ğŸš€ å¿«é€Ÿé–‹å§‹ï¼šä¸‹è¼‰å°ˆæ¡ˆèˆ‡è¨­å®šç’°å¢ƒ

### 1ï¸âƒ£ ä¸‹è¼‰å°ˆæ¡ˆ

```bash
git clone https://github.com/tibame05/web-crawler.git
cd web-crawler
```

### 2ï¸âƒ£ è¨­å®š Python ç’°å¢ƒï¼ˆä½¿ç”¨ Pyenv + Pipenvï¼‰

æœ¬å°ˆæ¡ˆæ¡ç”¨ Pyenv ç®¡ç† Python ç‰ˆæœ¬ï¼Œä¸¦ä½¿ç”¨ Pipenv ç®¡ç†è™›æ“¬ç’°å¢ƒèˆ‡ä¾è³´å¥—ä»¶ã€‚

#### ğŸ”§ å®‰è£æŒ‡å®š Python ç‰ˆæœ¬

ä½¿ç”¨ `pyenv` å®‰è£å°æ‡‰çš„ Python ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ 3.8.10ï¼‰

```bash
pyenv install 3.8.10
pyenv local 3.8.10
```

#### ğŸ“¦ å»ºç«‹ Pipenv è™›æ“¬ç’°å¢ƒ

ä½¿ç”¨ `pipenv` å»ºç«‹èˆ‡å‰›å‰›å®‰è£çš„ Python ç‰ˆæœ¬ç¶å®šçš„è™›æ“¬ç’°å¢ƒï¼š

```bash
pipenv --python ~/.pyenv/versions/3.8.10/bin/python
```

å®‰è£ `Pipfile` ä¸­å®šç¾©çš„æ‰€æœ‰å¥—ä»¶ï¼š

```bash
pipenv install
```

ä¹Ÿå¯ä»¥æ‰‹å‹•æ–°å¢ç‰¹å®šå¥—ä»¶ï¼Œä¾‹å¦‚å®‰è£ yfinanceï¼š

```bash
pipenv install yfinance==0.2.63
```

å•Ÿå‹• Python äº’å‹•æ¨¡å¼ï¼š

```bash
pipenv run python
```

#### ğŸ–¥ï¸ è£œå……ï¼šVS Code è¨­å®š Pipenv è™›æ“¬ç’°å¢ƒ

è‹¥ VS Code ç„¡æ³•è‡ªå‹•è¾¨è­˜Â `pipenv`Â çš„è™›æ“¬ç’°å¢ƒï¼Œå¯æ‰‹å‹•è¨­å®šï¼š

1. æŸ¥è©¢è™›æ“¬ç’°å¢ƒä½ç½®ï¼š
    
    ```bash
    pipenv --venv
    ```
    
    è¼¸å‡ºç¯„ä¾‹ï¼š
    
    ```swift
    /Users/joycehsu/.local/share/virtualenvs/web-crawler-v1TVI_3s
    ```
    
2. åœ¨ VS Code ä¸­ï¼š
    - é–‹å•Ÿ Command Paletteï¼ˆ`Cmd + Shift + P`ï¼‰
    - æœå°‹Â `Python: Select Interpreter`
    - è²¼ä¸Šå‰›å‰›çš„è·¯å¾‘ï¼ˆå®Œæ•´è·¯å¾‘è‡³Â `/bin/python`ï¼‰

#### ğŸ¥š Pipenv é–‹ç™¼æ¨¡å¼ï¼ˆå·²å»ºç«‹ï¼‰

è‹¥æ˜¯é–‹ç™¼æœ¬åœ°å¥—ä»¶ï¼ˆä¾‹å¦‚å»ºç«‹ `setup.py` çš„ Python å°ˆæ¡ˆï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ï¼š

```bash
pipenv install -e .
```

é€™æœƒå‡ºç¾ `.egg-info`ï¼Œä»£è¡¨å·²é€²å…¥ã€Œé–‹ç™¼æ¨¡å¼ã€ï¼Œå¯å³æ™‚ä¿®æ”¹åŸå§‹ç¢¼ç”Ÿæ•ˆã€‚

#### ğŸ” å¥—ä»¶åŒæ­¥ï¼ˆåœ˜éšŠå”ä½œï¼‰

ç•¶ä½ å¾ Git æ‹‰åˆ°å°ˆæ¡ˆå¾Œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤åŒæ­¥ `Pipfile.lock` ä¸­æ‰€æœ‰å®šç¾©çš„å¥—ä»¶ï¼š

```bash
pipenv sync
```

é€™æ¨£å¯ä»¥ç¢ºä¿ä½ å®‰è£çš„ç’°å¢ƒèˆ‡é–‹ç™¼åœ˜éšŠä¸€è‡´ã€‚

---

## ğŸ³ Docker æŒ‡ä»¤

### æ‰“åŒ… Image

```bash
docker build -f Dockerfile -t joycehsu65/web_crawler_tw:0.0.1 .
```
- âš ï¸ é€™è£¡çš„`joycehsu65`è¦æ›æˆè‡ªå·±çš„ Docker name

### æª¢æŸ¥å»ºç«‹çš„image

```bash
docker images
```

### ä¸Šå‚³ Image
```bash
docker push joycehsu65/web_crawler_tw:0.0.1
```

### åˆªé™¤ docker image
```bash
docker rmi joycehsu65/web_crawler_tw:0.0.1
```

---

## ğŸ§¨ éƒ¨ç½² RabbitMQ + Celery ä»»å‹™ç³»çµ±


### ğŸ§± 1. å»ºç«‹ Docker Networkï¼ˆä¸€æ¬¡å³å¯ï¼‰

```bash
docker network create etf_lib_network
```

### âš™ï¸ 2. è¨­å®š `.env` ç’°å¢ƒè®Šæ•¸ï¼ˆåƒ…éœ€ä¸€æ¬¡ï¼‰

è‹¥å°šæœªå»ºç«‹ `.env` æª”æ¡ˆï¼Œå¯åŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤ç”¢ç”Ÿï¼š

```bash
ENV=DOCKER python3 genenv.py
```

ç¢ºèª `.env` ä¸­åŒ…å«ï¼š

```env
RABBITMQ_HOST=127.0.0.1
```

### ğŸ° 3. å•Ÿå‹• RabbitMQï¼ˆDocker Composeï¼‰

```bash
docker compose -f rabbitmq-network.yml up -d
```

* å•Ÿå‹• RabbitMQ container èˆ‡å…¶ Web ç®¡ç†ä»‹é¢
* ç®¡ç†ä»‹é¢ç¶²å€ï¼š[http://127.0.0.1:15672](http://127.0.0.1:15672)
* é è¨­å¸³è™Ÿå¯†ç¢¼å¯æ–¼ `rabbitmq-network.yml` ä¸­è¨­å®šï¼ˆé€šå¸¸ç‚º `worker / worker`ï¼‰


### ğŸ” 4. æª¢æŸ¥èˆ‡é™¤éŒ¯å®¹å™¨

æŸ¥çœ‹ç›®å‰æ­£åœ¨é‹è¡Œçš„ containerï¼š

```bash
docker ps
```

æŸ¥çœ‹ RabbitMQ container logï¼š

```bash
docker logs web-crawler-rabbitmq-1
```

> ğŸ“ è‹¥ container åç¨±ä¸åŒï¼Œå¯ç”¨ `docker ps` ç¢ºèªæ­£ç¢ºåç¨±ã€‚


### ğŸ“¦ 5. å®‰è£ Celery

è«‹å…ˆå®‰è£æŒ‡å®šç‰ˆæœ¬çš„ Celeryï¼ˆå»ºè­°ç‰ˆæœ¬ï¼š5.5.0ï¼‰ï¼š

```bash
pipenv install celery==5.5.0
```


### ğŸš€ 6. ç™¼é€ä»»å‹™ï¼ˆProducerï¼‰

åŸ·è¡Œ `producer_main.py`ï¼Œå°‡ä»»å‹™åŠ å…¥ RabbitMQ ä½‡åˆ—ï¼š

```bash
pipenv run python crawler/producer_main.py
```

> ä»»å‹™å°‡é è¨­åŠ å…¥åç‚º `celery` çš„ä½‡åˆ—ã€‚


### ğŸ› ï¸ 7. å•Ÿå‹•å·¥äººï¼ˆWorkerï¼‰

å•Ÿå‹• Celery å·¥äººä¾†åŸ·è¡Œä½‡åˆ—ä»»å‹™ï¼š

```bash
pipenv run celery -A crawler.worker worker --loglevel=info
```

* `-A crawler.worker`ï¼šæŒ‡å®š Celery app çš„æ¨¡çµ„ä½ç½®
* `--loglevel=info`ï¼šé¡¯ç¤ºè©³ç´°ä»»å‹™è™•ç†ç´€éŒ„


### ğŸ–¥ï¸ 8. Flowerï¼šç›£æ§ä»»å‹™ç‹€æ…‹ï¼ˆWeb UIï¼‰

Flower æä¾› Celery ä»»å‹™çš„ç›£æ§ä»‹é¢ï¼Œå¯é€éç€è¦½å™¨æŸ¥çœ‹ï¼š
[http://127.0.0.1:5555](http://127.0.0.1:5555)


### ğŸ‘·â€â™€ï¸ 9. å•Ÿå‹•å¤šå€‹å·¥äººï¼ˆå¤šé€²ç¨‹ä»»å‹™è™•ç†ï¼‰

ä½ å¯ä»¥åŒæ™‚å•Ÿå‹•å¤šå€‹å·¥äººï¼Œæé«˜ä»»å‹™è™•ç†æ•ˆç‡ï¼š

```bash
pipenv run celery -A crawler.worker worker -n worker1 --loglevel=info
pipenv run celery -A crawler.worker worker -n worker2 --loglevel=info
```

* `-n worker1`ï¼šæŒ‡å®šå·¥äººåç¨±ï¼Œä¾¿æ–¼ç®¡ç†


### ğŸ›‘ 10. é—œé–‰å·¥äººï¼ˆWorkerï¼‰

åœ¨ terminal ä¸­å•Ÿå‹•çš„å·¥äººï¼Œå¯é€é `Ctrl + C` ä¸­æ–·åœæ­¢ã€‚


### âŒ 11. é—œé–‰ RabbitMQ

```bash
docker compose -f rabbitmq-network.yml down
```